---
title: "Reproducibility workshop"
author: "Eirini Zormpa"
output: html_document
---

# Set up

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

It's generally nice to load your packages at the beginning of the script.
That way whoever is looking at your script knows what packages they will need.
I like listing the install command at the beginning as well (commented out), so people can install packages if they want to.

```{r load_packages}
# install.packages("readr")
# install.packages("janitor")
# install.packages("tidyr")
# install.packages("dplyr")
# install.packages("magrittr")
# install.packages("ggplot2")

# to read in data as tibbles
library(readr)
# for easy data (in this case name) cleaning
library(janitor)
# for tidying data
library(tidyr)
# for wrangling data
library(dplyr)
# for pipes
library(magrittr)
# for beautiful plots
library(ggplot2)
```

Loading the packages gives me some warnings.
These are okay to ignore, R is just telling me that I have loaded packages that share function names.
Whichever was loaded last will be the one called, but I can still access the masked function by specifying which package I want.
This won't really be an issue today, but something to keep in mind.

It's really important to tell people what versions software you used for your analysis.
The reason it's important is that software updates can very easily break your code (e.g. the recent R 4.0 version release).
So if someone (including yourself) tries to run your code in 5 years, it's quite likely that some parts of it won't work.
If people know what versions last worked (and if they really care), they can always go back and try to reproduce the analysis with those versions.
That's *a lot* of work for the reproducer, but it's very easy to share, so why not!
An easy way to report these versions is by printing the session info at the beginning or the end of your analysis.

```{r session_info}
sessionInfo()
```


In this workshop we'll go through some basics on how to create, structure, and document reproducible projects in R.
We will then create an online version of that project that everyone can interact with *without having to download anything*.

For this workshop, we'll be using data from the World Happiness Reports (years 2015-2019), a survey used to rank the happiness of people in the participating countries.
The data come from [kaggle](https://www.kaggle.com/) and you can find the entry for this particular dataset [here](https://www.kaggle.com/unsdsn/world-happiness).

# Read data
Before we do anything, we need to get some data into R.
You can see below my feeble attempt to read in the data from 2019.
I mean... it works (you can try it), but my computer is in danger!

```{r read_data_bad}
setwd("C:/Users/eirin/Documents/MPI Psycholinguistics/Teaching/IMPRS_Conf2020")
ds <- read_csv("world-happiness/2019.csv")
```

We can do better than this!

```{r read_data_good}
# read in the data using a relative path
# if you ran the code above feel free to use 'ds' when reimporting the data

```

Hint: you might want to use the 'here' package to create the relative paths.


Now that we got our data into R, let's see what it looks like!

```{r glimpse_data}
# glimpse is a function from the dplyr package that gives you a, well, glimpse of your tibbles.
glimpse(ds)
```

Before we go any further, we need to deal with these names.
Spaces are generally not allowed in column names in R (here R is forced to accept them by using the backticks ``).
A really handy way to do this is by using the 'janitor' package.

```{r clean_names}
ds = janitor::clean_names(ds)
```

Let's take a look at what this has done:

```{r check_names}
glimpse(ds)
```

Okay, that looks much better!

# Explore

Let's explore our data a little bit.
I'm from Greece and was curious to see how Greece ranks in this survey.

```{r greece_happiness}
ds %>% filter(country_or_region == "Greece")
```

Feel free to explore these data a little bit too!
```{r }
# pick a country (whichever country) and see where it ranks
# head on over to mentimeter and tell us what rank you got!

```

# Plots

Let's play around with plots a little bit.
Here I've made a lollipop plot of the 10 happiest countries, ordered by their overall score.

```{r rank_lollipop}
ds %>%
  filter(overall_rank <= 10) %>%
  arrange(desc(overall_rank)) %>%
  mutate(country_or_region = factor(country_or_region, levels = country_or_region)) %>%
  ggplot(aes(x=country_or_region, y=score)) +
  geom_point(size = 4, colour = "skyblue") + 
  geom_segment( aes(x=country_or_region, xend=country_or_region, y=6.5, yend=score)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Overall happiness score", y = "")
```

# Analysis

```{r your_plot}
# feel free to practice ggplot here if you like and plot whatever you find interesting.
# the data for previous years is also available so you could explore how the ranking of countries may have changed.
```

