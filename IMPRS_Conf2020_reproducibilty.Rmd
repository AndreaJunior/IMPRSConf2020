---
title: "Reproducibility workshop"
author: "Eirini Zormpa"
date: "5th of June 2020"
output:
  html_document: 
    code_folding: show
    highlight: tango
    bibliography: bibliography.bib
    theme: flatly
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this workshop we'll go through some basics on how to create, structure, and document reproducible projects in R.
By the end of this workshop you will have created an online version of that project that everyone can interact with **without having to download anything**. In the process you'll also get some practice with git and GitHub.

Prerequisites:

* R and R Studio are installed
* git is installed
* git and R Studio have been connected
* you have created a GitHub account
* you have created an R project with version control from [here](https://github.com/eirini-zormpa/IMPRSConf2020).

Your level of R proficiency really doesn't matter for this, most interaction with code will be basically incidental.
That being said, you will have a chance to explore some data and practice whatever R skills you feel like practicing (data wrangling, plotting, or analysis) if you feel like it.

You also don't need to be super comfortable with Git.
We will not be doing anything particularly advanced here and I will always include the commands you will need.
In fact, everything we are doing should be possible through the R Studio IDE for git.

# Some basics
## Definitions
Before we get started, it's probably useful to agree on some definitions.
Thrilling stuff, I know, but bear with me.
*Reproducibility* has been taken to mean a variety of things, but here by reproducibility I mean *the ability to use someone else's data and code to get the same results they did*.
You could also call that *computational reproducibility*.
I quite like the chart from the [Turing Way](https://the-turing-way.netlify.app/reproducibility/03/definitions), reproduced below [@turing_way2019]:

![](images/turing_way_reproducibility.PNG)

## Why does reproducibility matter?
You're in this workshop already, so I'm guessing you have your own answers to this, but here's my two cents:

* reproducibility is a minimum requirement for verifying research.
* reproducibility can make you more organised and save you time if you ever need to go back to some of your analyses.

So let's get started on **how to make your analyses more reproducible**.

# Set up
Most of what we'll cover today does not actually involve much code--we'll mostly work on setting up projects with reproducibility in mind.

## Documentation
Good documentation is vital for helping others not only reproduce, but also understand your code.
As you may have noticed, this project has absolutely none if it.
That's because we'll be making it together!


### License
I cannot stress how important it is that you **license everything you share**.
Licenses are important because they tell others how they can use whatever it is you have shared.

**If you don't attach a license to your code/data/materials/whatever you're severely limiting how people can use it.**.

You hold the copyright of whatever it is you have created.
As you^[or often your employer] are the copyright holder, anyone who wants to use your work should technically ask for your permission to be do do.
Attaching a license to your work is like giving instructions to others about what they can do with it without having to ask you every time.
Technically, you could just come up with your own licenses for whatever you share.
But...

![](images/goldblum.gif)

There are **many** licenses out there that are well-recognised and  should cover whatever it is you want people to be able to do with your work.
You may have heard of the Creative Commons (CC) licenses.
There are great for a lot of creative work, e.g. articles or presentations, but they should generally be avoided for software.
If you like the CC-BY license, a software license that gives similar permissions is the MIT license.

#### practice
Okay so how do we add a license to our project?
You can do this really easily from GitHub:

1. Click on ```Create new file```
2. Name your new file "LICENSE"
3. Click on ```Choose a license template```
4. Select the MIT license (you can also preview your changes at this point)
5. Add an informative commit message
6. Click on ```Commit directly to the master branck```

Okay, we've actually made a change to this project!!
Note that now you have a file on your GitHub project that doesn't exist on your local version of the project.
It is now time to **pull** from GitHub.
Go to your R Studio and click on your Git tab (on the pane where your Environment is, by default on the top right).
There you will see a light blue arrow going down.
Click on it!

You should now see the LICENSE file if you look at your folder!

### README
Another important piece of documentation you should include in **every single project** is a README file.
What you should include in your README depends on the project you're sharing, but it should generally include information on:

* what your project is about
* installation instructions
* prerequisites
* license information
* contributors

I'm going to assume that you'd mostly be sharing code to allow other to reproduce your results.
In that case, you should also include instructions on the order in which people should run your scripts.

GitHub really tries to get people to add README files.
You'll see that it's already asking you to ```Add a README```

#### practice
So let's not disappoint GitHub!
To create a README file:

1. Click on the ```Add a README``` button
2. Edit the file to include relevant information (you don't need to spend too much time on this right now)
3. Write an informative commit message
4. Commit your changes

Again, make sure to go back to your R Studio and pull the changes you made from GitHub to your local repository.


### Codebook


## R Projects
If you're seeing this file, you're actually already using an R project! That's **awesome**.
What's so great about R projects you may ask?

Well, they:

* Are self-contained.
  * Everything that someone may need to reproduce your analysis **should live in the same project folder**.
* Start in a new session, giving you a clean environment without any loaded data, functions, or packages.
* Set the working directory to the project root, meaning you can use relative paths that will work on **anyone's** computer, not just yours! We'll talk about relative paths more later on.

And if that's not enough, they can also save your computer from arson!
![](images/computer_on_fire.PNG)

It's generally nice to load your packages at the beginning of the script.
That way whoever is looking at your script knows what packages they will need.
I like listing the install command at the beginning as well (commented out), so people can install packages if they want to.


## Folder structure


# Example code
## Install packages
```{r load_packages, collapse=TRUE}
# install.packages("readr")
# install.packages("janitor")
# install.packages("tidyr")
# install.packages("dplyr")
# install.packages("magrittr")
# install.packages("ggplot2")

# to read in data as tibbles
library(readr)
# for easy data (in this case name) cleaning
library(janitor)
# for tidying data
library(tidyr)
# for wrangling data
library(dplyr)
# for pipes
library(magrittr)
# for beautiful plots
library(ggplot2)
```

Loading the packages gives me some warnings.
These are okay to ignore, R is just telling me that I have loaded packages that share function names.
Whichever was loaded last will be the one called, but I can still access the masked function by specifying which package I want.
This won't really be an issue today, but something to keep in mind.

## Session info
It's really important to tell people what **software versions** you used for your analysis.
The reason it's important is that software updates can very easily break your code (e.g. the recent R 4.0.0 version release).
That is, if someone (including yourself) tries to run your code in 5 years, it's quite likely that some parts of it won't work.

If people know what versions last worked (and if they really care), they can always go back and try to reproduce the analysis with those versions.
That's *a lot* of work for the reproducer, but it's very easy to share, so why not!
An easy way to report these versions is by printing the session info at the beginning or the end of your analysis.
By the end of the workshop you'll (hopefully) know of better ways to help others reproduce your code.

```{r session_info}
sessionInfo()
```

## Read data
For this workshop, we'll be using data from the World Happiness Reports (years 2015-2019), a survey used to rank the happiness of people in the participating countries.
The data come from [kaggle](https://www.kaggle.com/) and you can find the entry for this particular dataset [here](https://www.kaggle.com/unsdsn/world-happiness).

Before we do anything, we need to get some data into R.
You can see below my feeble attempt to read in the data from 2019.
I mean... it works (you can try it), but my computer is in danger!

```{r read_data_bad, message=FALSE}
setwd("C:/Users/eirin/Documents/MPI Psycholinguistics/Teaching/IMPRSConf2020")
ds <- read_csv("raw-data/2019.csv")
```

We can do better than this!

### practice
```{r read_data_good}
# read in the data using a relative path
# if you ran the code above feel free to use 'ds' when reimporting the data

```

Hint: you might want to use the 'here' package to create the relative paths.


Now that we got our data into R, let's see what it looks like!

```{r glimpse_data}
# glimpse is a function from the dplyr package that gives you a, well, glimpse of your tibbles.
glimpse(ds)
```

Before we go any further, we need to deal with these names.
Spaces are generally not allowed in column names in R (here R is forced to accept them by using the backticks ``).
A really handy way to do this is by using the ```janitor``` package.

```{r clean_names}
ds = janitor::clean_names(ds)
```

Let's take a look at what this has done:

```{r check_names}
glimpse(ds)
```

Okay, that looks much better!

## Explore

Let's explore our data a little bit.
I'm from Greece and was curious to see how Greece ranks in this survey.

```{r greece_happiness}
ds %>% filter(country_or_region == "Greece")
```

### practice
Feel free to explore these data a little bit too!
```{r }
# pick a country (whichever country) and see where it ranks
# head on over to mentimeter and tell us what rank you got!

```

## Plot

Let's play around with plots a little bit.
Here I've made a lollipop plot of the 10 happiest countries, ordered by their overall score.

```{r rank_lollipop}
ds %>%
  filter(overall_rank <= 10) %>%
  arrange(desc(overall_rank)) %>%
  mutate(country_or_region = factor(country_or_region, levels = country_or_region)) %>%
  ggplot(aes(x=country_or_region, y=score)) +
  geom_point(size = 4, colour = "skyblue") + 
  geom_segment( aes(x=country_or_region, xend=country_or_region, y=6.5, yend=score)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Overall happiness score", y = "")
```

### practice

```{r your_plot}
# feel free to practice ggplot here if you like and plot whatever you find interesting.
# the data for previous years is also available so you could explore how the ranking of countries may have changed.
```

## Analyse
